import gameplay.*
import wollok.game.*
import music.*
import menu.*
import store.*
import objects.*
import gameplay.*

describe "Tests de Teclado" {
	
	// Controles para Mate
	const posInicialAuto = auto.position()
	test "Al tocar las teclas right y left, Mate se mueve hacia los costados" {
		auto.vidasEnPartida(1)
		auto.carril(2)
		juego.right()
		assert.notEquals(posInicialAuto,auto.position())
		auto.carril(2)
		juego.left()
		assert.notEquals(posInicialAuto,auto.position())
	}
	test "Cuando Mate se encuentra en los carriles extremos, no puede salirse de la ruta" {
		auto.carril(1)
		juego.left()
		assert.equals(posInicialAuto,auto.position())
		auto.carril(3)
		juego.right()
		assert.equals(posInicialAuto,auto.position())
	}
	
	// Controles para menú
	test "Al tocar down, el puntero apunta al botón tienda y, al tocar down de nuevo, a controles" {
        menu.down()
        assert.equals(puntero.apuntaA(), tienda)
        menu.down()
        assert.equals(puntero.apuntaA(), controles)
    }
    test "Al estar en el extremo de arriba, no se puede subir" {
        const posInicialPuntero = juego
        menu.up()
        assert.equals(puntero.apuntaA(), posInicialPuntero)
    }
	
	// Controles para tienda
	test "El seleccionador solo puede apuntar hacia tablas contiguas" {
		const posInicialSeleccionador = seleccionador.position()
		tienda.left()
		assert.equals(posInicialSeleccionador,seleccionador.position())
		tienda.down()
		assert.notEquals(posInicialSeleccionador,seleccionador.position())
	}
	test "Al seleccionar una tabla de la primera fila, Mate cambia su apariencia" {
		const imagenInicial = auto.image()
		monedasTienda.agregar(1000)
		tienda.enter()
		assert.notEquals(imagenInicial, auto.image())
		tienda.right()
		tienda.enter()
		assert.notEquals(imagenInicial, auto.image())
		tienda.right()
		tienda.enter()
		assert.notEquals(imagenInicial, auto.image())
	}
	test "Al seleccionar una tabla de la segunda fila, Mate obtiene mejoras" {
		const agilidadInicial = auto.agilidad()
		const vidas = auto.vidas()
		const tormentaInicial = tormenta.image()
		monedasTienda.agregar(1000)
		tienda.down()
		tienda.enter()
		assert.notEquals(tormenta.image(), tormentaInicial)
		tienda.right()
		tienda.enter()
		assert.that(agilidadInicial < auto.agilidad())
		tienda.right()
		tienda.enter()
		assert.that(vidas < auto.vidas())
	}
}


describe "Tests de Obstáculos" {
	
	// Vacas y Barriles
	test "Al chocarse contra un osbtáculo, Mate pierde una vida" {
		juego.mostrar()
		const obstaculo = new Barril()
		const vidas = auto.vidasEnPartida()	
		obstaculo.chocar()
		assert.that(auto.vidasEnPartida() < vidas)
	}
} 